<div class="row">
  <section>
    <h2>Attendance
      <button mat-mini-fab id="sort-menu" class="mx-1" matTooltip="Sort" matTooltipClass="action-tooltip"
        matTooltipPosition="above" [matMenuTriggerFor]="sortMenu">
        <mat-icon>sort</mat-icon>
      </button>
      <mat-menu #sortMenu="matMenu">
        <button mat-menu-item (click)="sort('o')">Oldest first</button>
        <button mat-menu-item (click)="sort('n')">Newest first</button>
      </mat-menu>
      <button mat-mini-fab id="export-menu" class="mx-1" matTooltip="Export" matTooltipClass="action-tooltip"
        matTooltipPosition="above" [matMenuTriggerFor]="exportMenu">
        <mat-icon>fact_check</mat-icon>
      </button>
      <mat-menu #exportMenu="matMenu">
        <button mat-menu-item (click)="exportToJSON()">JSON</button>
        <button mat-menu-item (click)="exportCSV()">Excel</button>
        <button mat-menu-item (click)="exportPDF()">PDF</button>
      </mat-menu>
      <button mat-mini-fab id="download-menu" class="mx-1" matTooltip="Download" matTooltipClass="action-tooltip"
        matTooltipPosition="above" [matMenuTriggerFor]="downloadMenu">
        <mat-icon>get_app</mat-icon>
      </button>
      <mat-menu #downloadMenu="matMenu">
        <button mat-menu-item (click)="downloadJSON()">JSON</button>
        <button mat-menu-item (click)="downloadCSV()">Excel</button>
        <button mat-menu-item (click)="downloadPDF()">PDF</button>
      </mat-menu>
    </h2>
    <div class="row p-0 mb-4">
      <div class="col-12 header-row">
        <div *ngIf="roles.includes('Data Analyst') || roles.includes('Team Leader')">
          <mat-form-field appearance="standard" class="col-6">
            <mat-label>View member attendance</mat-label>
            <mat-select [(ngModel)]="mSelected">
              <mat-option value="all" (click)="getAllUsersAttendanceEntries()">
                All members
              </mat-option>
              <mat-option *ngFor="let m of members" [value]="members.indexOf(m)" (click)="getUserAttendanceEntries(m.ID)">
                {{m.name}} {{m.surname}}</mat-option>
            </mat-select>
          </mat-form-field>
          <mat-radio-group aria-label="Select search type">
            <mat-radio-button [checked]="true" value="searchUsers" class="mx-2">Members
            </mat-radio-button>
          </mat-radio-group>
        </div>
        <mat-form-field appearance="standard" class="col-3">
          <mat-label>From:</mat-label>
          <input matInput type="date" [(ngModel)]="dateFrom" [max]="dateTo">
        </mat-form-field>
        <mat-form-field appearance="standard" class="col-3">
          <mat-label>To:</mat-label>
          <input matInput type="date" [(ngModel)]="dateTo" [min]="dateFrom">
        </mat-form-field>
        <button mat-mini-fab id="get-attendance" class="mx-1" matTooltip="Get Attendance" matTooltipClass="action-tooltip"
          matTooltipPosition="above" [disabled]="dateFrom == null || dateTo == null" (click)="getAttendance()">
          <mat-icon>check</mat-icon>
        </button>
        <mat-form-field class="col-2" appearance="standard">
          <mat-label>Show Fields</mat-label>
          <mat-select multiple [(ngModel)]="displayedColumns" name="item">
            <mat-option *ngFor="let c of allColumns" [value]="c">{{c}}</mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>

    <div id="history" class="scroll">
      <mat-spinner *ngIf="tableData == []"></mat-spinner>
      <!-- display data -->
      <div>
        <mat-accordion>
          <mat-expansion-panel *ngFor="let t of tableData" class="pb-3">
            <mat-expansion-panel-header>
              <mat-panel-title>
                {{t.month}}
              </mat-panel-title>
            </mat-expansion-panel-header>
            <table mat-table #table [dataSource]="t.records" class="col-12">
              <!-- date -->
              <ng-container matColumnDef="Date">
                <th mat-header-cell *matHeaderCellDef> Date </th>
                <td mat-cell *matCellDef="let element"> {{element.fDate}} </td>
              </ng-container>
              <!-- startTime -->
              <ng-container matColumnDef="Start Time">
                <th mat-header-cell *matHeaderCellDef> Start </th>
                <td mat-cell *matCellDef="let element"> {{element.startTime}} </td>
              </ng-container>
              <!-- endTime -->
              <ng-container matColumnDef="End Time">
                <th mat-header-cell *matHeaderCellDef> End </th>
                <td mat-cell *matCellDef="let element"> {{element.endTime}} </td>
              </ng-container>
              <!-- description -->
              <ng-container class="device-col" matColumnDef="Device">
                <th mat-header-cell *matHeaderCellDef> Device </th>
                <td mat-cell *matCellDef="let element"> {{element.device}} </td>
              </ng-container>
              <!-- name -->
              <ng-container matColumnDef="Name">
                <th mat-header-cell *matHeaderCellDef> Name </th>
                <td mat-cell *matCellDef="let element"> {{element.name}} </td>
              </ng-container>
              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
            </table>
          </mat-expansion-panel>
        </mat-accordion>
      </div>
    </div>
  </section>
</div>
