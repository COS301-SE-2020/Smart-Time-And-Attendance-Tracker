<div class="row">
  <section>
    <h2>History
      <button mat-mini-fab id="sort-menu" class="mx-1"
              matTooltip="Sort"
              matTooltipClass="action-tooltip"
              matTooltipPosition="above"
              [matMenuTriggerFor]="sortMenu">
        <mat-icon>sort</mat-icon>
      </button>
      <mat-menu #sortMenu="matMenu">
        <button mat-menu-item (click)="sort('o')">Oldest first</button>
        <button mat-menu-item (click)="sort('n')">Newest first</button>
      </mat-menu>
      <button *ngIf="roles.includes('Data Analyst') || roles.includes('Team Leader')"
              mat-mini-fab id="import-menu" class="mx-1"
              matTooltip="Import"
              matTooltipClass="action-tooltip"
              matTooltipPosition="above"
              [matMenuTriggerFor]="importMenu">
        <mat-icon>note_add</mat-icon>
        </button>
      <mat-menu #importMenu="matMenu">
        <button mat-menu-item (click)="openJSON()">JSON</button>
        <button mat-menu-item>Excel</button>
      </mat-menu>
      <input id="json-input" type="file" style="display: none;" accept="application/json" (change)="readJSON($event)" />
      <button mat-mini-fab id="export-menu" class="mx-1"
              matTooltip="Export"
              matTooltipClass="action-tooltip"
              matTooltipPosition="above"
              [matMenuTriggerFor]="exportMenu">
        <mat-icon>fact_check</mat-icon>
      </button>
      <mat-menu #exportMenu="matMenu">
        <button mat-menu-item (click)="exportToJSON()">JSON</button>
        <button mat-menu-item>PDF</button>
        <button mat-menu-item>Excel</button>
      </mat-menu>
      <button mat-mini-fab id="download-menu" class="mx-1"
              matTooltip="Download"
              matTooltipClass="action-tooltip"
              matTooltipPosition="above"
              [matMenuTriggerFor]="downloadMenu">
        <mat-icon>get_app</mat-icon>
      </button>
      <mat-menu #downloadMenu="matMenu">
        <button mat-menu-item (click)="downloadJSON()">JSON</button>
        <button mat-menu-item>PDF</button>
        <button mat-menu-item (click)="downloadCSV()">Excel</button>
      </mat-menu>
    </h2>
    <div class="row p-0 mb-4">
      <div class="col-12 header-row">
        <div *ngIf="roles.includes('Data Analyst') || roles.includes('Team Leader')">
        <mat-form-field *ngIf="toggle == false" appearance="standard" class="col-6">
          <mat-label>View Project Entries</mat-label>
          <mat-select [(ngModel)]="pSelected">
            <mat-option *ngFor="let p of projects" [value]="p.ID" (click)="getAllProject(p.ID)">{{p.projectName}}</mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field *ngIf="toggle == true" appearance="standard" class="col-6">
          <mat-label>View Member Entries</mat-label>
          <mat-select [(ngModel)]="mSelected">
            <mat-option *ngFor="let m of members" [value]="m.ID" (click)="getUser(m.ID)">{{m.name}} {{m.surname}}</mat-option>
          </mat-select>
        </mat-form-field>
        <mat-radio-group aria-label="Select search type">
          <mat-radio-button [checked]="!toggle" value="searchProjects" class="mx-2" (click)="toggle = false">Projects</mat-radio-button>
          <mat-radio-button [checked]="toggle" value="searchUsers" class="mx-2" (click)="toggle = true">Members</mat-radio-button>
        </mat-radio-group>
        </div>
        <mat-form-field appearance="standard" class="col-3">
          <mat-label>From:</mat-label>
          <input matInput type="date" [(ngModel)]="dateFrom" [max]="dateTo">
        </mat-form-field>
        <mat-form-field appearance="standard" class="col-3">
          <mat-label>To:</mat-label>
          <input matInput type="date" [(ngModel)]="dateTo" [min]="dateFrom">
        </mat-form-field>
        <button mat-mini-fab id="get-history" class="mx-1"
              matTooltip="Get History"
              matTooltipClass="action-tooltip"
              matTooltipPosition="above"
              [disabled]="dateFrom == null || dateTo == null"
              (click)="getHistory()">
        <mat-icon>check</mat-icon>
      </button>
        <mat-form-field class="col-2" appearance="standard">
          <mat-label>Show Fields</mat-label>
          <mat-select multiple [(ngModel)]="displayedColumns" name="item">
            <mat-option *ngFor="let c of allColumns" [value]="c">{{c}}</mat-option>
          </mat-select>
        </mat-form-field>      
      </div>
      <div class="col-10 header-row">
        <!--<mat-form-field class="col-3">
          <mat-select appearance="standard" placeholder="Active time" name="item">
            <mat-option>Less than 1h</mat-option>
            <mat-option>Less than 2h</mat-option>
            <mat-option>Less than 4h</mat-option>
            <mat-option>Less than 6h</mat-option>
            <mat-option>More than 6h</mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field class="col-3">
          <mat-select appearance="standard" placeholder="Monetary value" name="item">
            <mat-option>Less than R 100.00</mat-option>
            <mat-option>Less than R 500.00</mat-option>
            <mat-option>Less than R 1,000.00</mat-option>
            <mat-option>Less than R 5,000.00</mat-option>
            <mat-option>More than R 5,000.00</mat-option>
          </mat-select>
        </mat-form-field>-->
      </div>
    </div>
    <div class="col-12 justify-content-end">
      
      
    </div>


    <div id="history" class="scroll">
      <mat-spinner *ngIf="!tableData"></mat-spinner>

      <div>       
        <mat-accordion>
          <mat-expansion-panel *ngFor="let t of tableData" class="pb-3">
            <mat-expansion-panel-header>
              <mat-panel-title>
                {{t.month}}
              </mat-panel-title>
            </mat-expansion-panel-header>
            <table mat-table #table [dataSource]="t.records" class="col-12">
              <!-- date -->
              <ng-container matColumnDef="Date">
                  <th mat-header-cell *matHeaderCellDef> Date </th>
                  <td mat-cell *matCellDef="let element"> {{element.fDate}} </td>
              </ng-container>
              <!-- startTime -->
              <ng-container matColumnDef="Start Time">
                  <th mat-header-cell *matHeaderCellDef> Start </th>
                  <td mat-cell *matCellDef="let element"> {{element.startTime}} </td>
              </ng-container>
              <!-- endTime -->
              <ng-container matColumnDef="End Time">
                  <th mat-header-cell *matHeaderCellDef> End </th>
                  <td mat-cell *matCellDef="let element"> {{element.endTime}} </td>
              </ng-container>
              <!-- active time -->
              <ng-container matColumnDef="Active Time">
                  <th mat-header-cell *matHeaderCellDef> Active</th>
                  <td mat-cell *matCellDef="let element"> {{element.activeTime}} </td>
              </ng-container>
              <!-- description -->
              <ng-container class="description-col" matColumnDef="Description">
                  <th mat-header-cell *matHeaderCellDef> Description </th>
                  <td mat-cell *matCellDef="let element"> {{element.description}} </td>
              </ng-container>
              <!-- project -->
              <ng-container matColumnDef="Project">
                  <th mat-header-cell *matHeaderCellDef> Project </th>
                  <td mat-cell *matCellDef="let element"> {{element.project}} </td>
              </ng-container>
              <!-- task -->
              <ng-container matColumnDef="Task">
                  <th mat-header-cell *matHeaderCellDef> Task </th>
                  <td mat-cell *matCellDef="let element"> {{element.task}} </td>
              </ng-container>
              <!-- value -->
              <ng-container matColumnDef="Monetary Value">
                  <th mat-header-cell *matHeaderCellDef> Value </th>
                  <td mat-cell *matCellDef="let element"> {{element.monetaryValue}} </td>
              </ng-container>
              <!-- member -->
              <ng-container matColumnDef="Member">
                  <th mat-header-cell *matHeaderCellDef> Member </th>
                  <td mat-cell *matCellDef="let element"> {{element.member}} </td>
              </ng-container>
              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
            </table>
          </mat-expansion-panel>
        </mat-accordion>
      </div>
    </div>
  </section>
</div>
